<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台積電(2330)股票資訊 - 含預測模型</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        /* [保持所有原有的CSS樣式不變] */
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
            background-color: #f5f5f5;
        }
        /* [其餘CSS保持不變] */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>台積電(2330)股票資訊 - 含預測模型</h1>
        </header>
        
        <div class="stock-info">
            <div class="info-item">
                <h3>當前價格</h3>
                <div class="price" id="current-price">載入中...</div>
            </div>
            <div class="info-item">
                <h3>今日最高</h3>
                <div id="day-high">載入中...</div>
            </div>
            <div class="info-item">
                <h3>今日最低</h3>
                <div id="day-low">載入中...</div>
            </div>
            <div class="info-item">
                <h3>昨日收盤</h3>
                <div id="previous-close">載入中...</div>
            </div>
        </div>
        
        <h2 class="section-title">即時走勢圖</h2>
        <div class="chart-container">
            <h3>今日股價走勢</h3>
            <div id="plot-1day"></div>
        </div>
        
        <h2 class="section-title">近期走勢</h2>
        <div class="chart-container">
            <h3>近一週股價走勢</h3>
            <div id="plot-1week"></div>
        </div>
        
        <div class="chart-container">
            <h3>近兩週股價走勢</h3>
            <div id="plot-2weeks"></div>
        </div>
        
        <div class="chart-container">
            <h3>近一個月股價走勢</h3>
            <div id="plot-1month"></div>
        </div>
        
        <h2 class="section-title">未來30天股價預測 (Prophet模型)</h2>
        <div class="chart-container">
            <div id="prophet-forecast"></div>
            <div class="forecast-note">
                <p><strong>注意：</strong>此預測基於Facebook Prophet時間序列模型，僅供參考不構成投資建議。股票市場受多種因素影響，實際走勢可能與預測有顯著差異。</p>
            </div>
        </div>
        
        <h2 class="section-title">歷史交易數據</h2>
        <table class="history-table">
            <thead>
                <tr>
                    <th>日期</th>
                    <th>開盤價</th>
                    <th>最高價</th>
                    <th>最低價</th>
                    <th>收盤價</th>
                    <th>成交量</th>
                </tr>
            </thead>
            <tbody id="history-table-body">
                <!-- 數據將由JavaScript填充 -->
            </tbody>
        </table>
        
        <h2 class="section-title">相關新聞</h2>
        <div class="news-container" id="news-container">
            <!-- 新聞將由JavaScript填充 -->
        </div>
        
        <div class="update-time" id="last-updated">
            最後更新時間: 載入中...
        </div>
    </div>

    <script>
        // 載入數據並渲染頁面
        document.addEventListener('DOMContentLoaded', function() {
            fetch('data.json')
                .then(response => response.json())
                .then(data => {
                    // 更新基本資訊
                    document.getElementById('current-price').textContent = data.current_price + ' TWD';
                    document.getElementById('day-high').textContent = data.day_high + ' TWD';
                    document.getElementById('day-low').textContent = data.day_low + ' TWD';
                    document.getElementById('previous-close').textContent = data.previous_close + ' TWD';
                    
                    // 更新最後更新時間
                    const lastUpdated = new Date(data.last_updated);
                    document.getElementById('last-updated').textContent = '最後更新時間: ' + lastUpdated.toLocaleString();
                    
                    // 填充歷史數據表格
                    const historyTable = document.querySelector('#history-table-body');
                    data.history.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.date}</td>
                            <td>${item.open}</td>
                            <td>${item.high}</td>
                            <td>${item.low}</td>
                            <td>${item.close}</td>
                            <td>${item.volume.toLocaleString()}</td>
                        `;
                        historyTable.appendChild(row);
                    });
                    
                    // 填充新聞數據
                    const newsContainer = document.getElementById('news-container');
                    if (data.news && data.news.length > 0) {
                        data.news.forEach(item => {
                            const newsItem = document.createElement('div');
                            newsItem.className = 'news-item';
                            const date = new Date(item.publishedAt * 1000 || item.publishedAt);
                            newsItem.innerHTML = `
                                <h3><a href="${item.link}" target="_blank">${item.title}</a></h3>
                                <p>${item.publisher} - ${date.toLocaleString()}</p>
                            `;
                            newsContainer.appendChild(newsItem);
                        });
                    } else {
                        newsContainer.innerHTML = '<p>目前沒有相關新聞</p>';
                    }
                })
                .catch(error => {
                    console.error('載入數據失敗:', error);
                });
            
            // 載入圖表
            function loadPlot(elementId, filename) {
                fetch(filename)
                    .then(response => response.text())
                    .then(html => {
                        const container = document.getElementById(elementId);
                        container.innerHTML = html;
                        // 重新執行Plotly的JavaScript
                        const scripts = container.getElementsByTagName('script');
                        for (let script of scripts) {
                            if (script.innerText) {
                                eval(script.innerText);
                            }
                        }
                    })
                    .catch(error => {
                        console.error(`載入 ${filename} 失敗:`, error);
                        document.getElementById(elementId).innerHTML = 
                            `<div class="alert alert-error">無法載入圖表: ${error.message}</div>`;
                    });
            }
            
            // 載入所有圖表
            loadPlot('plot-1day', 'plot_1day.html');
            loadPlot('plot-1week', 'plot_1week.html');
            loadPlot('plot-2weeks', 'plot_2weeks.html');
            loadPlot('plot-1month', 'plot_1month.html');
            loadPlot('prophet-forecast', 'prophet_forecast.html');
        });
    </script>
</body>
</html>
